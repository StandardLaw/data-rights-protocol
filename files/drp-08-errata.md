During the development of one of the Privacy Infrastructure Provider implementations of DRP 0.7 a poor interaction was revealed between the protocol's request signing specification and Amazon's HTTP API Gateway. In short, the HTTP API Gateway does not support forwarding `application/octet-stream` requests without silently corrupting the request body. Further research reveals that while other gateway and request router products could be configured to support this, in the year 2023 binary streams cannot simply be sent over the internet as we have proposed doing without care. `libsodium`'s signature validation is such that it's difficult to tell between the signature being corrupted by a middleware or a message being maliciously tampered with, and so we are taking a chance to make the requests more robust.

In [data-rights-protocol#67](https://github.com/consumer-reports-innovation-lab/data-rights-protocol/pull/67) I propose to modify the `POST /v1/` endpoints so that the request bodies are `base64` encoded. We're not terribly happy to see more complexity layered on top of a system we are already asking you to review and implement from first-principles but heading off these sort of subtle compatibility/data-integrity issues early on will smooth the way to broader implementation and adoption. This is the very reason we have been doing these small implementation tests and prototypes with the DRP consortium members

This round-about begs an obvious question of whether we are reinventing a version of JSON Web Tokens which I want to address. The biggest concern for me in implementing the signing strategy for DRP is the feasibility of token replacement or request forgery. While JWTs have much more "battle testing", it's a standard that simply has too much going on to be used unambiguously. The [No way, JOSE!](https://paragonie.com/blog/2017/03/jwt-json-web-tokens-is-bad-standard-that-everyone-should-avoid) security engineering writeup explains how the ambiguity of the JWT envelope spec JOSE can lead to security blunders which could undermine trust in this system, and [JWT attacks and vulnerabilities](https://www.invicti.com/blog/web-security/json-web-token-jwt-attacks-vulnerabilities/) describes the complexity of using these safely within a system. Our DRP request "tokens" are relatively simple and only have a single path of construction with few options to confuse or misuse.

The level of logical-checks that would have to go in to validating that a JWT is operating within the specification we have outlined is essentially the same amount of work as the validation mechanisms outlined in the DRP's [section 3.07](https://github.com/consumer-reports-innovation-lab/data-rights-protocol/blob/main/data-rights-protocol.md#user-content-307-api-authentication) and the failure mode of the "envelope validation" of the JWT itself is such that a tampered JWT could be passed through to JWT APIs without having the proper logical validation done on the signature material.

As Kevin Riggle wrote in [our original proposal for the security model](https://raw.githubusercontent.com/consumer-reports-digital-lab/data-rights-protocol/main/files/DRP_security_model.pdf) we are currently implementing:

> This choice represents both the best advice from cryptographers and cryptographic engineers
> we trust, as well as our own experience working with JWT libraries. Libsodium is easier to
> integrate correctly and supports much stronger and more modern cryptographic algorithms
> (Ed25519). While a lot of us have substantial experience using JWTs correctly having used
> them as part of e.g. OAuth2 integrations, anybody who has done so knows exactly how fiddly
> they can be to get right

